1. 这个BUG什么情况下出现？什么情况下不出现？两种情况的区别在哪里？

2. 这个BUG之前没有，现在出现了，中间都动了什么？

3. 这个BUG生产环境出现测试环境不出现，两个环境区别是什么？

4. 同样的功能，这样操作没有BUG，那样有BUG，两个操作的区别是什么？

这些问题搞清楚了，可以采用代码回退、修改配置、环境替换等方式验证BUG是否会消失，然后再找其中的原因。

下面列出一些常见的疑难BUG类型以及每种BUG的诊断方法：

1. **输出结果与预期不符**，这种BUG一般都是由于代码逻辑错误造成的，如果能在开发环境重现，最好解决方法就是单步调试，设定每一步代码的预期结果，然后跟踪判断实际结果是否与预期结果一致，不一致的分析原因，如果在开发环境无法重现，无法单步调试的，可以采用添加输出日志的方式判断哪一步的问题。

2. **系统异常报错**，这种情况下需要提取日志，找出错误堆栈信息，这时候最重要的事情是要把堆栈信息看懂、看完整。这是很多经验不足的程序员常见的问题，就知道报错了，报的什么错，这个错代表什么一概不知。而且往往堆栈信息是一个套一个输出的，比如Java里面表象上看是一个NullPointer Exception，但是如果你看到底，就会告诉你到底是什么错误引发了这个NullPointer。

3. **系统Crash**，这个问题常见的原因是负载过高、并发过高、或者配置错误。最常见的就是内存溢出。这时候要首先排除配置错误的原因，主要靠查看Crash Log来分析原因，如果Crash Log没有有用的信息，就得排查硬件、内存、网络等方面的设置，看是否有配置错误的地方。再找不到就在测试环境用开发模式进行压测和调试。

4. **系统响应缓慢**，这种问题一般是存在资源竞争或者系统资源不足的情况，举一个Java应用的例子来说，如果某些功能出现系统响应慢，处理步骤如下：

-   查询TCP链接数是否超出系统可承受范围，命令：netstat -nat | awk '{print $6}' | sort | uniq -c | sort -n ， 主要查看ESTABLISHED、TIME_WAIT、CLOSE_WAIT这几个数量是否异常过大。  
    
-   查询Java线程数是否正常，命令：ps -eLf | grep java -c  
    
-   查看和分析gc情况，命令：jstat -gcutil [76691 1000](tel:76691%201000) 5  
    
-   用jstack查看Java线程状态，命令 jstack pid >> xxxxx.txt，然后从这个文件里面分析java线程中各种状态线程的数量，命令：grep java.lang.Thread.State xxxxx.txt | awk '{print $2$3$4$5}' | sort | uniq -c ， 如果有非常多的blocked和deadlocked状态的线程，这个地方就是问题所在了。  
    

通过这些步骤，找出那些功能、那个方法、那段代码存在瓶颈和资源竞争，针对性的对这个地方进行改造就行了。

在知乎上的格式比较烂，链接也没有了。推荐去原文阅读： [如何快速高效地修 bug？ - 依云&amp;amp;#x27;s Blog](http://blog.lilydjwg.me/2017/1/6/how-to-fix-bugs-quickly.208166.html)

看回答，有一些可操作性很强的答案。但是呢，你知道的，考试好不代表能力强，如果你只是学习别人的方法而并不理解，那么学来之后只会是东施效颦而不能融会贯通。所以呢，我也来发表一下自己的见解。

首先，你要定位 bug。这时，你需要：

1.  注重逻辑性。不要做没有证据的结论。如果你有猜测，就去证实或者否定它。比如某次，同事代码返回的数据有问题，认为是缓存用的 Redis 有问题，返回了错误的数据。然而没人去对此猜测进行求证……我去确认了一下，Redis 收到了请求，并且响应正常。接下来，排除所有其它可能的原因之后，最后剩下的那个就是真相。真相就是，代码里有个 } 的位置放错了，因为它刚好在一屏之后的位置，所以没有人发现……（是 Vim 帮我找到的）
2.  基本的方法论。比如二分法。比如最小化测试用例。如果你要提问，要懂得提问的智慧，不管是向搜索引擎还是向人，你都需要提出正确的问题。
3.  知识面。你写 Web 后端的话，普通的 HTTP 得懂，浏览器的开发者工具得会用。简单的 JavaScript 也有会点儿。简单地说就是，你要精于你自己主攻的部分，然后要熟悉你的上下游。再比如如果你使用 CPython 的话，你要准备一份 CPython 的源码，并且要能够流畅地阅读 C 代码。
4.  工具。工欲善其事，必先利其器。一大堆调试用的工具，你至少得知道它们能干什么，需要的时候能用。比如 strace、lsof、gdb、git bisect，还有高级点的 sysdig、systemtap、perf 等等。当然还有一堆不是专门为调试而设计的通用工具，比如 the silver searcher 或者 ripgrep。一个快速的全文搜索工具能帮你在最短时间内找到相关的代码或者日志。你不必成为正则表达式大师，但是简单的一定要会，不然面对上千个匹配结果你要怎么办呢？Vim 有一个插件 Mark，能够同时高亮多个模式，非常利于调试期间阅读代码和日志。投入时间学习使用高效的工具，不要把时间浪费在等待和人工搜索上，也不要让自己忙于琐事而断了灵感和线索。

最后，不要不断地、毫无目的地换个环境啦，换个版本啦，换个用户啦，这样子找问题。如果这样做很有效的话，大家都去买彩票去了。

找到 bug 之后，理解它是如何产生的。当你理解之后才能真正修好它。就像你感冒了吃抗生素，根本没有用。

![[Pasted image 20220311000455.png]]